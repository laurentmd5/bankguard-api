apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: bankguard-dev

resources:
  - ../../base

# Utiliser la nouvelle syntaxe "patches" pour Kustomize v5+
patches:
  - target:
      kind: Deployment
      name: bankguard-api
    path: deployment-patch.yaml
  - target:
      kind: ConfigMap
      name: bankguard-config
    path: configmap-patch.yaml

# Images spécifiques dev (remplacer "latest" ou SHA selon workflow GHCR)
images:
  - name: bankguard-api
    newName: ghcr.io/laurentmd5/bankguard-api
    newTag: latest-dev

# Génération de ConfigMap spécifique dev
configMapGenerator:
  - name: bankguard-config
    behavior: merge
    literals:
      - ENVIRONMENT=development
      - LOG_LEVEL=DEBUG
      - DB_HOST=postgres-service.bankguard-dev.svc.cluster.local
      - REDIS_HOST=redis-service.bankguard-dev.svc.cluster.local
      - FLASK_ENV=development

# Génération de Secret spécifique dev
secretGenerator:
  - name: bankguard-secrets
    behavior: merge
    literals:
      - DB_PASSWORD=dev_password_123
      - REDIS_PASSWORD=dev_redis_123
    type: Opaque
